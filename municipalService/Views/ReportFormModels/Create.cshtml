@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
   

} 
@model municipalService.Models.ReportFormModel
<style>
    body{
        padding: 100px;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 100px;
    }
    .btn-pink {
        background-color: #efc7f9;
        color: #0a2463;
        font-weight: bold;
        border: none;
        transition: transform 0.2s, box-shadow 0.3s;
    }

        .btn-pink:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(239, 199, 249, 0.6);
        }

    #formProgressBar {
        background-color: #efc7f9 !important;
        color: #0a2463;
        font-weight: bold;
    }

    .sticky-progress {
        position: fixed;
        top: 120px;
        left: 0;
        width: 100%;
        height: 25px;
        z-index: 1030;
    }
</style>

<div class="container p-4" style="max-width:600px; background-color:#c9e8ff; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.1);">


    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success text-center fw-bold" style="color:#0a2463;">
            @TempData["Message"]
        </div>
    }

    <!-- Sticky Progress Bar below navbar -->
    <div class="progress sticky-progress">
        <div id="formProgressBar" class="progress-bar bg-success" role="progressbar"
             style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            0%
        </div>
    </div>
    <h3 class="text-center mb-4">Submit an Issue</h3>
    
    <form id="issueForm" asp-action="Submit" asp-controller="ReportFormModels" method="post" enctype="multipart/form-data">
       
        @Html.AntiForgeryToken()

        <!-- Reporter Name -->
        <div class="mb-3">
            <label asp-for="RName">Name</label>
            <input asp-for="RName" class="form-control required-field" placeholder="Enter your full name" />
            <span asp-validation-for="RName" class="text-danger"></span>
        </div>

        <!-- Reporter Number -->
        <div class="mb-3">
            <label asp-for="Rnum">Contact Number</label>
            <input asp-for="Rnum" class="form-control required-field" placeholder="Enter your contact number" />
            <span asp-validation-for="Rnum" class="text-danger"></span>
        </div>

        <!-- Description (Rich Text) -->
        <div class="mb-3">
            <label asp-for="Description">Description</label>
            <div id="descriptionEditor" style="height:200px;"></div>
            <input type="hidden" asp-for="Description" id="Description" />
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <!-- Location -->
        <div class="mb-3">
            <label asp-for="Location">Location</label>
            <input asp-for="Location" class="form-control required-field" placeholder="Enter location" />
            <span asp-validation-for="Location" class="text-danger"></span>
        </div>

        <!-- Category Dropdown -->
        <div class="mb-3">
            <label asp-for="Category">Category</label>
            <select asp-for="Category" class="form-select required-field">
                <option value="">-- Select a category --</option>
                <option value="Water">Water</option>
                <option value="Sanitation">Sanitation</option>
                <option value="Electricity">Electricity</option>
                <option value="Roads">Roads / Potholes</option>
                <option value="Waste">Waste Management</option>
                <option value="Other">Other</option>
            </select>
            <span asp-validation-for="Category" class="text-danger"></span>
        </div>

        <!-- File Upload -->
        <div class="mb-3">
            <label asp-for="FileUpload">Upload Photo (optional)</label>
            <input asp-for="FileUpload" type="file" class="form-control" />
            <span asp-validation-for="FileUpload" class="text-danger"></span>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-pink w-100">Submit Report</button>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // Initialize Quill editor
            var quill = new Quill('#descriptionEditor', {
                theme: 'snow',
                placeholder: 'Describe the issue...',
                modules: {
                    toolbar: [
                        [{ header: [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline'],
                        [{ list: 'ordered' }, { list: 'bullet' }],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });

            // Elements
            const form = document.getElementById("issueForm");
            const requiredFields = document.querySelectorAll(".required-field");
            const progressBar = document.getElementById("formProgressBar");
            const hiddenDescription = document.getElementById("Description");

            // Update progress
            function updateProgress() {
                let filled = 0;

                // Count Quill content
                const descriptionContent = quill.getText().trim();
                if (descriptionContent.length > 0) filled++;

                // Count other required fields
                requiredFields.forEach(field => {
                    if (field.value.trim() !== "") filled++;
                });

                const totalFields = requiredFields.length + 1; // +1 for Description
                const percent = Math.round((filled / totalFields) * 100);

                progressBar.style.width = percent + "%";
                progressBar.setAttribute("aria-valuenow", percent);
                progressBar.textContent = percent + "%";
            }

            // Listen for changes
            requiredFields.forEach(field => {
                field.addEventListener("input", updateProgress);
                field.addEventListener("change", updateProgress);
            });
            quill.on('text-change', updateProgress);

            // Set Quill HTML to hidden input before submit
            form.onsubmit = function () {
                hiddenDescription.value = quill.root.innerHTML;
            };

            // Initial update
            updateProgress();
        });
    </script>
}

